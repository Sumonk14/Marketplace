{% extends 'layout.html' %}

{% block body %}
    <h1>Dashboard <small> welcome {{session.username}}</small></h1>
    <a class="btn btn-success" href="{{ url_for('add_article') }}">Add Article</a>
    <hr>
    <table class="table table-striped">
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Date</th>
            <th></th>
            <th></th>
        </tr>
        {% for article in articles %}
            <tr>
                <td>{{article.id}}</td>
                <td>{{article.title}}</td>
                <td>{{article.author}}</td>
                <td>{{article.create_date}}</td>
            </tr>
        {% endfor %}
    </table>
<script>
    $(document).ready(function(){
        // Attach click event to all elements with class 'delete-article'
        $('.delete-article').on('click', function(e){
            e.preventDefault(); // Stop the default link action (going to '#')
            
            // Confirm with the user before deleting
            if (confirm('Are you sure you want to delete this item? This action is irreversible and the image will also be removed.')) {
                
                // Get the ID of the article from the 'data-id' attribute
                const id = $(this).attr('data-id');
                
                // Send the AJAX POST request to the Flask route
                $.ajax({
                    type: 'POST',
                    url: '/delete_article/'+id,
                    success: function(response){
                        // On success, show a flash message and remove the item's row/card from the DOM
                        console.log('Item Deleted!');
                        
                        // Use a basic redirect or remove the element from the list
                        window.location.href = '/dashboard'; 
                        
                        // NOTE: If you wanted a *pure* AJAX experience without reload, 
                        // you would remove the specific item element here instead of redirecting.
                    },
                    error: function(xhr, status, error){
                        console.log(xhr.responseText);
                        alert('Error deleting item. Check console for details.');
                    }
                });
            }
        });
    });
</script>
{% endblock %}